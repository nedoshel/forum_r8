// stimulus_reflex@3.5.5 downloaded from https://ga.jspm.io/npm:stimulus_reflex@3.5.5/dist/stimulus_reflex.js

import{Controller as e}from"@hotwired/stimulus";import t,{Utils as o}from"cable_ready";import{createConsumer as r}from"@rails/actioncable";
/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */class Toastify{defaults={oldestFirst:true,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:false,close:false,gravity:"toastify-top",positionLeft:false,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:true,onClick:function(){},offset:{x:0,y:0},escapeMarkup:true,ariaLive:"polite",style:{background:""}};constructor(e){this.version="1.12.0";this.options={};this.toastElement=null;this._rootElement=document.body;this._init(e)}showToast(){this.toastElement=this._buildToast();typeof this.options.selector==="string"?this._rootElement=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||this.options.selector instanceof ShadowRoot?this._rootElement=this.options.selector:this._rootElement=document.body;if(!this._rootElement)throw"Root element is not defined";this._rootElement.insertBefore(this.toastElement,this._rootElement.firstChild);this._reposition();this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((()=>{this._removeElement(this.toastElement)}),this.options.duration));return this}hideToast(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue);this._removeElement(this.toastElement)}_init(e){this.options=Object.assign(this.defaults,e);this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');this.toastElement=null;this.options.gravity=e.gravity==="bottom"?"toastify-bottom":"toastify-top";this.options.stopOnFocus=e.stopOnFocus===void 0||e.stopOnFocus;e.backgroundColor&&(this.options.style.background=e.backgroundColor)}_buildToast(){if(!this.options)throw"Toastify is not initialized";let e=document.createElement("div");e.className=`toastify on ${this.options.className}`;e.className+=` toastify-${this.options.position}`;e.className+=` ${this.options.gravity}`;for(const t in this.options.style)e.style[t]=this.options.style[t];this.options.ariaLive&&e.setAttribute("aria-live",this.options.ariaLive);if(this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)e.appendChild(this.options.node);else{this.options.escapeMarkup?e.innerText=this.options.text:e.innerHTML=this.options.text;if(this.options.avatar!==""){let t=document.createElement("img");t.src=this.options.avatar;t.className="toastify-avatar";this.options.position=="left"?e.appendChild(t):e.insertAdjacentElement("afterbegin",t)}}if(this.options.close===true){let t=document.createElement("button");t.type="button";t.setAttribute("aria-label","Close");t.className="toast-close";t.innerHTML="&#10006;";t.addEventListener("click",(e=>{e.stopPropagation();this._removeElement(this.toastElement);window.clearTimeout(this.toastElement.timeOutValue)}));const o=window.innerWidth>0?window.innerWidth:screen.width;this.options.position=="left"&&o>360?e.insertAdjacentElement("afterbegin",t):e.appendChild(t)}if(this.options.stopOnFocus&&this.options.duration>0){e.addEventListener("mouseover",(t=>{window.clearTimeout(e.timeOutValue)}));e.addEventListener("mouseleave",(()=>{e.timeOutValue=window.setTimeout((()=>{this._removeElement(e)}),this.options.duration)}))}typeof this.options.destination!=="undefined"&&e.addEventListener("click",(e=>{e.stopPropagation();this.options.newWindow===true?window.open(this.options.destination,"_blank"):window.location=this.options.destination}));typeof this.options.onClick==="function"&&typeof this.options.destination==="undefined"&&e.addEventListener("click",(e=>{e.stopPropagation();this.options.onClick()}));if(typeof this.options.offset==="object"){const t=this._getAxisOffsetAValue("x",this.options);const o=this._getAxisOffsetAValue("y",this.options);const r=this.options.position=="left"?t:`-${t}`;const n=this.options.gravity=="toastify-top"?o:`-${o}`;e.style.transform=`translate(${r},${n})`}return e}_removeElement(e){e.className=e.className.replace(" on","");window.setTimeout((()=>{this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node);e.parentNode&&e.parentNode.removeChild(e);this.options.callback.call(e);this._reposition()}),400)}_reposition(){let e={top:15,bottom:15};let t={top:15,bottom:15};let o={top:15,bottom:15};let r=this._rootElement.querySelectorAll(".toastify");let n;for(let s=0;s<r.length;s++){n=r[s].classList.contains("toastify-top")===true?"toastify-top":"toastify-bottom";let i=r[s].offsetHeight;n=n.substr(9,n.length-1);let l=15;let a=window.innerWidth>0?window.innerWidth:screen.width;if(a<=360){r[s].style[n]=`${o[n]}px`;o[n]+=i+l}else if(r[s].classList.contains("toastify-left")===true){r[s].style[n]=`${e[n]}px`;e[n]+=i+l}else{r[s].style[n]=`${t[n]}px`;t[n]+=i+l}}}_getAxisOffsetAValue(e,t){return t.offset[e]?isNaN(t.offset[e])?t.offset[e]:`${t.offset[e]}px`:"0px"}}function n(e){return new Toastify(e)}t.operations.stimulusReflexVersionMismatch=e=>{const t={info:{},success:{background:"#198754",color:"white"},warn:{background:"#ffc107",color:"black"},error:{background:"#dc3545",color:"white"}};const o={selector:s(),close:true,duration:3e4,gravity:"bottom",position:"right",newWindow:true,style:t[e.level||"info"]};n({...o,...e}).showToast()};function s(){const e="stimulus-reflex-toast-element";let t=document.querySelector(`#${e}`);if(!t){t=document.createElement("div");t.id=e;document.documentElement.appendChild(t);const o=document.createElement("style");o.innerHTML=`\n      #${e} .toastify {\n         padding: 12px 20px;\n         color: #ffffff;\n         display: inline-block;\n         background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n         background: linear-gradient(135deg, #73a5ff, #5477f5);\n         position: fixed;\n         opacity: 0;\n         transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n         border-radius: 2px;\n         cursor: pointer;\n         text-decoration: none;\n         max-width: calc(50% - 20px);\n         z-index: 2147483647;\n         bottom: -150px;\n         right: 15px;\n      }\n\n      #${e} .toastify.on {\n        opacity: 1;\n      }\n\n      #${e} .toast-close {\n        background: transparent;\n        border: 0;\n        color: white;\n        cursor: pointer;\n        font-family: inherit;\n        font-size: 1em;\n        opacity: 0.4;\n        padding: 0 5px;\n      }\n    `;document.head.appendChild(o)}return t}let i=true;var l={get enabled(){return i},get disabled(){return!i},get value(){return i},set(e){i=!!e},set deprecate(e){i=!!e}};let a=false;var c={get enabled(){return a},get disabled(){return!a},get value(){return a},set(e){a=!!e},set debug(e){a=!!e}};const d={reflexAttribute:"data-reflex",reflexPermanentAttribute:"data-reflex-permanent",reflexRootAttribute:"data-reflex-root",reflexSuppressLoggingAttribute:"data-reflex-suppress-logging",reflexDatasetAttribute:"data-reflex-dataset",reflexDatasetAllAttribute:"data-reflex-dataset-all",reflexSerializeFormAttribute:"data-reflex-serialize-form",reflexFormSelectorAttribute:"data-reflex-form-selector",reflexIncludeInnerHtmlAttribute:"data-reflex-include-inner-html",reflexIncludeTextContentAttribute:"data-reflex-include-text-content"};let u={};var f={set(e){u={...d,...e.schema};for(const e in u){const t=e.slice(0,-9);Object.defineProperty(this,t,{get:()=>u[e],configurable:true})}}};const{debounce:p,dispatch:m,xpathToElement:h,xpathToElementArray:g}=o;const x=()=>{const e=window.crypto||window.msCrypto;return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))};const b=(e,t={})=>{if(!e)return"";const o=t.w||window;const{element:r}=t;const n=new o.FormData(e);const s=Array.from(n,(e=>e.map(encodeURIComponent).join("=")));const i=e.querySelector("input[type=submit]");r&&r.name&&r.nodeName==="INPUT"&&r.type==="submit"?s.push(`${encodeURIComponent(r.name)}=${encodeURIComponent(r.value)}`):i&&i.name&&s.push(`${encodeURIComponent(i.name)}=${encodeURIComponent(i.value)}`);return Array.from(s).join("&")};const v=(e,t=true)=>{if(typeof e!=="string")return"";e=e.replace(/[\s_](.)/g,(e=>e.toUpperCase())).replace(/[\s_]/g,"").replace(/^(.)/,(e=>e.toLowerCase()));t&&(e=e.substr(0,1).toUpperCase()+e.substr(1));return e};const y=h;const w=g;const E=(e,t={})=>m(document,e,t);const _=e=>{const t=e.match(/(?:.*->)?(.*?)(?:Reflex)?#/);return t?t[1]:""};const C=e=>{if(e.id!=="")return"//*[@id='"+e.id+"']";if(e===document.body)return"/html/body";if(e.nodeName==="HTML")return"/html";let t=0;const o=e&&e.parentNode?e.parentNode.childNodes:[];for(var r=0;r<o.length;r++){const n=o[r];if(n===e){const o=C(e.parentNode);const r=e.tagName.toLowerCase();const n=t+1;return`${o}/${r}[${n}]`}n.nodeType===1&&n.tagName===e.tagName&&t++}};const R=e=>e.type==="number"&&e.validity&&e.validity.badInput;const L=(e,t)=>e[0]&&e[0].nodeType===Node.ELEMENT_NODE?e.shift():t;const $=e=>{const t={};if(e[0]&&typeof e[0]==="object"&&Object.keys(e[0]).filter((e=>["id","attrs","selectors","reflexId","resolveLate","serializeForm","suppressLogging","includeInnerHTML","includeTextContent"].includes(e))).length){const o=e.shift();Object.keys(o).forEach((e=>{if(e==="reflexId"){l.enabled&&console.warn("reflexId option will be removed in v4. Use id instead.");t.id=o.reflexId}else t[e]=o[e]}))}return t};const A=e=>{let t=[];while(t.length===0&&e){let o=e.getAttribute(f.reflexRoot);if(o){o.length===0&&e.id&&(o=`#${e.id}`);const r=o.split(",").filter((e=>e.trim().length));c.enabled&&r.length===0&&console.error(`No value found for ${f.reflexRoot}. Add an #id to the element or provide a value for ${f.reflexRoot}.`,e);t=t.concat(r.filter((e=>document.querySelector(e))))}e=e.parentElement?e.parentElement.closest(`[${f.reflexRoot}]`):null}return t};const O=e=>e.replace(/([a-z0–9])([A-Z])/g,"$1-$2").replace(/(::)/g,"--").replace(/-reflex$/gi,"").toLowerCase();const k=["created","before","delivered","queued","after","finalized","success","error","halted","forbidden"];let S;const T=new Proxy({},{get:function(e,t){return k.includes(t)?Object.fromEntries(Object.entries(e).filter((([e,o])=>o.stage===t))):t==="last"?S:t==="all"?e:Reflect.get(...arguments)},set:function(e,t,o){e[t]=o;S=o;return true}});const j=(e,t)=>{const o=e.controller[["before","after","finalize"].includes(t)?`${t}${v(e.action)}`:`${v(e.action,false)}${v(t)}`];const r=e.controller[["before","after","finalize"].includes(t)?`${t}Reflex`:`reflex${v(t)}`];typeof o==="function"&&o.call(e.controller,e.element,e.target,e.error,e.id,e.payload);typeof r==="function"&&r.call(e.controller,e.element,e.target,e.error,e.id,e.payload)};const N=(e,t)=>{if(!e.controller.element.parentElement){if(c.enabled&&!e.warned){console.warn(`StimulusReflex was not able execute callbacks or emit events for "${t}" or later life-cycle stages for this Reflex. The StimulusReflex Controller Element is no longer present in the DOM. Could you move the StimulusReflex Controller to an element higher in your DOM?`);e.warned=true}return}e.stage=t;e.lifecycle.push(t);const o=`stimulus-reflex:${t}`;const r=`${o}:${e.action}`;const n={reflex:e.target,controller:e.controller,id:e.id,element:e.element,payload:e.payload};const s={bubbles:true,cancelable:false,detail:n};e.controller.element.dispatchEvent(new CustomEvent(o,s));e.controller.element.dispatchEvent(new CustomEvent(r,s));if(window.jQuery){window.jQuery(e.controller.element).trigger(o,n);window.jQuery(e.controller.element).trigger(r,n)}};document.addEventListener("stimulus-reflex:before",(e=>j(T[e.detail.id],"before")),true);document.addEventListener("stimulus-reflex:queued",(e=>j(T[e.detail.id],"queued")),true);document.addEventListener("stimulus-reflex:delivered",(e=>j(T[e.detail.id],"delivered")),true);document.addEventListener("stimulus-reflex:success",(e=>{const t=T[e.detail.id];j(t,"success");N(t,"after")}),true);document.addEventListener("stimulus-reflex:nothing",(e=>N(T[e.detail.id],"success")),true);document.addEventListener("stimulus-reflex:error",(e=>{const t=T[e.detail.id];j(t,"error");N(t,"after")}),true);document.addEventListener("stimulus-reflex:halted",(e=>j(T[e.detail.id],"halted")),true);document.addEventListener("stimulus-reflex:forbidden",(e=>j(T[e.detail.id],"forbidden")),true);document.addEventListener("stimulus-reflex:after",(e=>j(T[e.detail.id],"after")),true);document.addEventListener("stimulus-reflex:finalize",(e=>j(T[e.detail.id],"finalize")),true);let D={};var I={get app(){return D},set(e){D=e}};let z=false;var F={get disabled(){return!z},set(e){z=e;l.enabled&&!z&&document.addEventListener("DOMContentLoaded",(()=>console.warn("Deprecation warning: the next version of StimulusReflex will standardize isolation mode, and the isolate option will be removed.\nPlease update your applications to assume that every tab will be isolated. Use CableReady operations to broadcast updates to other tabs and users.")),{once:true})}};class Reflex{constructor(e,t){this.data=e.valueOf();this.controller=t;this.element=e.reflexElement;this.id=e.id;this.error=null;this.payload=null;this.stage="created";this.lifecycle=["created"];this.warned=false;this.target=e.target;this.action=e.target.split("#")[1];this.selector=null;this.morph=null;this.operation=null;this.timestamp=new Date;this.cloned=false}get getPromise(){const e=new Promise(((e,t)=>{this.promise={resolve:e,reject:t,data:this.data}}));e.id=this.id;Object.defineProperty(e,"reflexId",{get(){l.enabled&&console.warn("reflexId is deprecated and will be removed from v4. Use id instead.");return this.id}});e.reflex=this;c.enabled&&e.catch((()=>{}));return e}}const M=e=>{if(!e.cableReady)return;if(e.version.replace(".pre","-pre").replace(".rc","-rc")!==t.version){const o=`CableReady failed to execute your reflex action due to a version mismatch between your gem and JavaScript version. Package versions must match exactly.\n\ncable_ready gem: ${e.version}\ncable_ready npm: ${t.version}`;console.error(o);c.enabled&&t.operations.stimulusReflexVersionMismatch({text:o,level:"error"});return}let o=[];for(let t=e.operations.length-1;t>=0;t--)if(e.operations[t].stimulusReflex){o.push(e.operations[t]);e.operations.splice(t,1)}if(o.some((e=>e.stimulusReflex.url!==location.href))&&c.enabled){console.error("Reflex failed due to mismatched URL.");return}let r;if(o.length){r=o[0].stimulusReflex;r.payload=o[0].payload}if(r){const{id:n,payload:s}=r;let i;if(!T[n]&&F.disabled){const e=y(r.xpathController);const t=y(r.xpathElement);e.reflexController=e.reflexController||{};e.reflexData=e.reflexData||{};e.reflexError=e.reflexError||{};const o=I.app.getControllerForElementAndIdentifier(e,r.reflexController);e.reflexController[n]=o;e.reflexData[n]=r;i=new Reflex(r,o);T[n]=i;i.cloned=true;i.element=t;o.lastReflex=i;N(i,"before");i.getPromise}else i=T[n];if(i){i.payload=s;i.totalOperations=o.length;i.pendingOperations=o.length;i.completedOperations=0;i.piggybackOperations=e.operations;t.perform(o)}}else e.operations.length&&T[e.operations[0].reflexId]&&t.perform(e.operations)};let P;let H;let q;let U;const V=(e,t)=>{P=e;H=t;document.addEventListener("DOMContentLoaded",(()=>{U=false;G();l.enabled&&e&&console.warn("Deprecation warning: the next version of StimulusReflex will obtain a reference to consumer via the Stimulus application object.\nPlease add 'application.consumer = consumer' to your index.js after your Stimulus application has been established, and remove the consumer key from your StimulusReflex initialize() options object.")}));document.addEventListener("turbolinks:load",G);document.addEventListener("turbo:load",G)};const W=e=>{if(q)return;P=P||e.application.consumer||r();const{channel:t}=e.StimulusReflex;const o={channel:t,...H};const n=JSON.stringify(o);q=P.subscriptions.findAll(n)[0]||P.subscriptions.create(o,{received:M,connected:B,rejected:J,disconnected:Q})};const B=()=>{U=true;G();E("stimulus-reflex:connected");Object.values(T.queued).forEach((e=>{q.send(e.data);N(e,"delivered")}))};const J=()=>{U=false;G();E("stimulus-reflex:rejected");Debug.enabled&&console.warn("Channel subscription was rejected.")};const Q=e=>{U=false;G();E("stimulus-reflex:disconnected",e)};const Z=e=>{if(U){q.send(e.data);N(e,"delivered")}else N(e,"queued")};const G=()=>{const e=document.body.classList;e.contains("stimulus-reflex-connected")||e.contains("stimulus-reflex-disconnected")?U?e.replace("stimulus-reflex-disconnected","stimulus-reflex-connected"):e.replace("stimulus-reflex-connected","stimulus-reflex-disconnected"):e.add(U?"stimulus-reflex-connected":"stimulus-reflex-disconnected")};var K={subscribe:W,deliver:Z,initialize:V};const X=e=>{c.disabled||e.data.suppressLogging||console.log(`↑ stimulus ↑ ${e.target}`,{id:e.id,args:e.data.args,controller:e.controller.identifier,element:e.element,controllerElement:e.controller.element})};const Y=e=>{if(c.disabled||e.data.suppressLogging)return;const t={id:e.id,morph:e.morph,payload:e.payload};e.operation!=="dispatch_event"&&(t.operation=e.operation);console.log(`↓ reflex ↓ ${e.target} → ${e.selector||"∞"}${ne(e)} ${re(e)}`,t)};const ee=e=>{c.disabled||e.data.suppressLogging||console.log(`↓ reflex ↓ ${e.target} ${re(e)} %cHALTED`,"color: #ffa500;",{id:e.id,payload:e.payload})};const te=e=>{c.disabled||e.data.suppressLogging||console.log(`↓ reflex ↓ ${e.target} ${re(e)} %cFORBIDDEN`,"color: #BF40BF;",{id:e.id,payload:e.payload})};const oe=e=>{c.disabled||e.data.suppressLogging||console.log(`↓ reflex ↓ ${e.target} ${re(e)} %cERROR: ${e.error}`,"color: #f00;",{id:e.id,payload:e.payload})};const re=e=>e.cloned?"CLONED":`in ${new Date-e.timestamp}ms`;const ne=e=>e.totalOperations>1?` ${e.completedOperations}/${e.totalOperations}`:"";var se={request:X,success:Y,halted:ee,forbidden:te,error:oe};const ie=e=>!!["checkbox","radio"].includes(e.type)&&document.querySelectorAll(`input[type="${e.type}"][name="${e.name}"]`).length>1;const le=e=>Array.from(e.querySelectorAll("option:checked")).concat(Array.from(document.querySelectorAll(`input[type="${e.type}"][name="${e.name}"]`)).filter((e=>e.checked))).map((e=>e.value));const ae=(e=[])=>{const t=Array.from(new Set(e.filter((e=>e&&String(e).length)).map((e=>e.trim())))).join(" ").trim();return t.length>0?t:null};const ce=e=>e&&e.length?e.split(" ").filter((e=>e.trim().length)):[];const de=e=>{let t=Array.from(e.attributes).reduce(((e,t)=>{e[t.name]=t.value;return e}),{});t.checked=!!e.checked;t.selected=!!e.selected;t.tag_name=e.tagName;if(e.tagName.match(/select/i)||ie(e)){const o=le(e);t.values=o;t.value=o.join(",")}else t.value=e.value;return t};const ue=(e,t)=>{if(!t||t.length===0)return[];let o=[e];const r=C(e);t.forEach((e=>{try{switch(e){case"combined":l.enabled&&console.warn("In the next version of StimulusReflex, the 'combined' option to data-reflex-dataset will become 'ancestors'.");o=[...o,...w(`${r}/ancestor::*`,true)];break;case"ancestors":o=[...o,...w(`${r}/ancestor::*`,true)];break;case"parent":o=[...o,...w(`${r}/parent::*`)];break;case"siblings":o=[...o,...w(`${r}/preceding-sibling::*|${r}/following-sibling::*`)];break;case"children":o=[...o,...w(`${r}/child::*`)];break;case"descendants":o=[...o,...w(`${r}/descendant::*`)];break;default:o=[...o,...document.querySelectorAll(e)]}}catch(e){c.enabled&&console.error(e)}}));return o};const fe=e=>{const t=e.attributes[f.reflexDataset];const o=e.attributes[f.reflexDatasetAll];const r=t&&t.value.split(" ")||[];const n=o&&o.value.split(" ")||[];const s=ue(e,r);const i=ue(e,n);const l=s.reduce(((e,t)=>({...pe(t),...e})),{});const a=pe(e);const c={dataset:{...a,...l},datasetAll:{}};i.forEach((e=>{const t=pe(e);Object.keys(t).forEach((e=>{const o=t[e];c.datasetAll[e]&&Array.isArray(c.datasetAll[e])?c.datasetAll[e].push(o):c.datasetAll[e]=[o]}))}));return c};const pe=e=>{let t={};e&&e.attributes&&Array.from(e.attributes).forEach((e=>{e.name.startsWith("data-")&&(t[e.name]=e.value)}));return t};var me="stimulus_reflex";var he="3.5.5";var ge="Build reactive applications with the Rails tooling you already know and love.";var xe=["ruby","rails","websockets","actioncable","turbolinks","reactive","cable","ujs","ssr","stimulus","reflex","stimulus_reflex","dom","morphdom"];var be="https://docs.stimulusreflex.com";var ve="https://github.com/stimulusreflex/stimulus_reflex/issues";var ye="https://github.com/stimulusreflex/stimulus_reflex";var we="MIT";var Ee="Nathan Hopkins <natehop@gmail.com>";var _e=["Andrew Mason <andrewmcodes@protonmail.com>","Julian Rubisch <julian@julianrubisch.at>","Marco Roth <marco.roth@intergga.ch>","Nathan Hopkins <natehop@gmail.com>"];var Ce="./dist/stimulus_reflex.js";var Re="./dist/stimulus_reflex.js";var Le="./dist/stimulus_reflex.js";var $e="./dist/stimulus_reflex.umd.js";var Ae="./dist/stimulus_reflex.umd.js";var Oe=["dist/*","javascript/*"];var ke={lint:"yarn run format --check",format:"yarn run prettier-standard ./javascript/**/*.js rollup.config.mjs",build:"yarn rollup -c","build:watch":"yarn rollup -wc",watch:"yarn build:watch",test:"web-test-runner javascript/test/**/*.test.js","test:watch":"yarn test --watch","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs && cp docs/_redirects docs/.vitepress/dist","docs:preview":"vitepress preview docs"};var Se={"@hotwired/stimulus":">= 3.0"};var Te={"@hotwired/stimulus":"^3","@rails/actioncable":"^6 || ^7 || ^8",cable_ready:"^5.0.6"};var je={"@open-wc/testing":"^4.0.0","@rollup/plugin-json":"^6.1.0","@rollup/plugin-node-resolve":"^15.3.0","@rollup/plugin-terser":"^0.4.4","@web/dev-server-esbuild":"^1.0.2","@web/dev-server-rollup":"^0.6.4","@web/test-runner":"^0.19.0","prettier-standard":"^16.4.1",rollup:"^4.22.4","toastify-js":"^1.12.0",vitepress:"^1.0.0-beta.1"};var Ne={name:me,version:he,description:ge,keywords:xe,homepage:be,bugs:ve,repository:ye,license:we,author:Ee,contributors:_e,main:Ce,module:Re,browser:Le,import:"./dist/stimulus_reflex.js",unpkg:$e,umd:Ae,files:Oe,scripts:ke,peerDependencies:Se,dependencies:Te,devDependencies:je};class ReflexData{constructor(e,t,o,r,n,s,i,l,a){this.options=e;this.reflexElement=t;this.controllerElement=o;this.reflexController=r;this.permanentAttributeName=n;this.target=s;this.args=i;this.url=l;this.tabId=a}get attrs(){this._attrs=this._attrs||this.options.attrs||de(this.reflexElement);return this._attrs}get id(){this._id=this._id||this.options.id||x();return this._id}get selectors(){this._selectors=this._selectors||this.options.selectors||A(this.reflexElement);return typeof this._selectors==="string"?[this._selectors]:this._selectors}get resolveLate(){return this.options.resolveLate||false}get dataset(){this._dataset=this._dataset||fe(this.reflexElement);return this._dataset}get innerHTML(){return this.includeInnerHtml?this.reflexElement.innerHTML:""}get textContent(){return this.includeTextContent?this.reflexElement.textContent:""}get xpathController(){return C(this.controllerElement)}get xpathElement(){return C(this.reflexElement)}get formSelector(){const e=this.reflexElement.attributes[f.reflexFormSelector]?this.reflexElement.attributes[f.reflexFormSelector].value:void 0;return this.options.formSelector||e}get includeInnerHtml(){const e=this.reflexElement.attributes[f.reflexIncludeInnerHtml]||false;return!(!this.options.includeInnerHTML&&!e)&&e.value!=="false"}get includeTextContent(){const e=this.reflexElement.attributes[f.reflexIncludeTextContent]||false;return!(!this.options.includeTextContent&&!e)&&e.value!=="false"}get suppressLogging(){return this.options.suppressLogging||this.reflexElement.attributes[f.reflexSuppressLogging]||false}valueOf(){return{attrs:this.attrs,dataset:this.dataset,selectors:this.selectors,id:this.id,resolveLate:this.resolveLate,suppressLogging:this.suppressLogging,xpathController:this.xpathController,xpathElement:this.xpathElement,inner_html:this.innerHTML,text_content:this.textContent,formSelector:this.formSelector,reflexController:this.reflexController,permanentAttributeName:this.permanentAttributeName,target:this.target,args:this.args,url:this.url,tabId:this.tabId,version:Ne.version}}}let De={};var Ie={get plugin(){return De},set(e){De=e}};const ze=e=>{const{stimulusReflex:t}=e.detail||{};if(!t)return;const o=T[t.id];o.pendingOperations--;if(!(o.pendingOperations>0)){t.resolveLate||setTimeout((()=>o.promise.resolve({element:o.element,event:e,data:o.data,payload:o.payload,id:o.id,toString:()=>""})));setTimeout((()=>N(o,"success")))}};const Fe=e=>{const{stimulusReflex:o}=e.detail||{};if(!o)return;const r=T[o.id];r.completedOperations++;r.selector=e.detail.selector;r.morph=e.detail.stimulusReflex.morph;r.operation=e.type.split(":")[1].split("-").slice(1).join("_");se.success(r);if(!(r.completedOperations<r.totalOperations)){o.resolveLate&&setTimeout((()=>r.promise.resolve({element:r.element,event:e,data:r.data,payload:r.payload,id:r.id,toString:()=>""})));setTimeout((()=>N(r,"finalize")));r.piggybackOperations.length&&t.perform(r.piggybackOperations)}};const Me=e=>{const{stimulusReflex:o,name:r}=e.detail||{};const n=r.split("-")[2];const s={nothing:Pe,halted:He,forbidden:qe,error:Ue};if(!o||!Object.keys(s).includes(n))return;const i=T[o.id];i.completedOperations++;i.pendingOperations--;i.selector=e.detail.selector;i.morph=e.detail.stimulusReflex.morph;i.operation=e.type.split(":")[1].split("-").slice(1).join("_");n==="error"&&(i.error=e.detail.error);s[n](i,e);setTimeout((()=>N(i,n)));i.piggybackOperations.length&&t.perform(i.piggybackOperations)};const Pe=(e,t)=>{se.success(e);setTimeout((()=>e.promise.resolve({data:e.data,element:e.element,event:t,payload:e.payload,id:e.id,toString:()=>""})))};const He=(e,t)=>{se.halted(e,t);setTimeout((()=>e.promise.resolve({data:e.data,element:e.element,event:t,payload:e.payload,id:e.id,toString:()=>""})))};const qe=(e,t)=>{se.forbidden(e,t);setTimeout((()=>e.promise.resolve({data:e.data,element:e.element,event:t,payload:e.payload,id:e.id,toString:()=>""})))};const Ue=(e,t)=>{se.error(e,t);setTimeout((()=>e.promise.reject({data:e.data,element:e.element,event:t,payload:e.payload,id:e.id,error:e.error,toString:()=>e.error})))};const Ve=e=>{const t=ce(e.getAttribute(f.controller));const o=t.map((t=>I.app.getControllerForElementAndIdentifier(e,t)));return o.filter((e=>e&&e.StimulusReflex))};const We=e=>{let t=[];while(e){t=t.concat(Ve(e));e=e.parentElement}return t};const Be=(e,t)=>{const o=t.find((t=>{if(!t||!t.identifier)return;const o=O(_(e));return o===t.identifier}));return o};const Je=p((()=>{const e=document.querySelectorAll(`[${f.reflex}]`);e.forEach((e=>Qe(e)))}),20);const Qe=(e,t=null)=>{const o=e.getAttribute(f.controller);const r=ce(o).filter((e=>e!=="stimulus-reflex"));const n=e.getAttribute(f.reflex);const s=ce(n);const i=e.getAttribute(f.action);const l=ce(i).filter((e=>!e.includes("#__perform")));s.forEach((o=>{const n=[t].concat(We(e));t=Be(o,n);const s=t?t.identifier:"stimulus-reflex";l.push(`${o.split("->")[0]}->${s}#__perform`);const i=e.closest(`[data-controller~=${s}]`);const a=e===i&&s==="stimulus-reflex";i&&!a||r.push(s)}));const a=ae(r);const c=ae(l);let d=false;if(a&&e.getAttribute(f.controller)!=a){e.setAttribute(f.controller,a);d=true}if(c&&e.getAttribute(f.action)!=c){e.setAttribute(f.action,c);d=true}d&&m(e,"stimulus-reflex:ready",{reflex:n,controller:a,action:c,element:e})};class StimulusReflexController extends e{constructor(...e){super(...e);Ke(this)}}const Ze=x();const Ge=(e,{controller:t,consumer:o,debug:r,params:n,isolate:s,deprecate:i,transport:a}={})=>{Ie.set(a||K);Ie.plugin.initialize(o,n);F.set(!!s);I.set(e);f.set(e);I.app.register("stimulus-reflex",t||StimulusReflexController);c.set(!!r);typeof i!=="undefined"&&l.set(i);const d=new MutationObserver(Je);d.observe(document.documentElement,{attributeFilter:[f.reflex,f.action],childList:true,subtree:true});E("stimulus-reflex:initialized")};const Ke=(e,t={})=>{const o="StimulusReflex::Channel";e.StimulusReflex={...t,channel:o};Ie.plugin.subscribe(e);Object.assign(e,{stimulate(){const e=location.href;const t=this.element;const o=Array.from(arguments);const r=o.shift()||"StimulusReflex::Reflex#default_reflex";const n=L(o,t);if(R(n)){c.enabled&&console.warn("Reflex aborted: invalid numeric input");return}const s=$(o);const i=new ReflexData(s,n,t,this.identifier,f.reflexPermanent,r,o,e,Ze);const a=i.id;t.reflexController=t.reflexController||{};t.reflexData=t.reflexData||{};t.reflexError=t.reflexError||{};t.reflexController[a]=this;t.reflexData[a]=i.valueOf();const d=new Reflex(i,this);T[a]=d;this.lastReflex=d;N(d,"before");setTimeout((()=>{const{params:e}=t.reflexData[a]||{};const o=n.attributes[f.reflexSerializeForm];o&&(s.serializeForm=o.value!=="false");const r=n.closest(i.formSelector)||document.querySelector(i.formSelector)||n.closest("form");l.enabled&&s.serializeForm===void 0&&r&&console.warn(`Deprecation warning: the next version of StimulusReflex will not serialize forms by default.\nPlease set ${f.reflexSerializeForm}="true" on your Reflex Controller Element or pass { serializeForm: true } as an option to stimulate.`);const c=s.serializeForm===false?"":b(r,{element:n});d.data={...i.valueOf(),params:e,formData:c};t.reflexData[a]=d.data;Ie.plugin.deliver(d)}));se.request(d);return d.getPromise},__perform(e){let t=e.target;let o;while(t&&!o){o=t.getAttribute(f.reflex);o&&o.trim().length||(t=t.parentElement)}const r=ce(o).find((t=>t.split("->")[0]===e.type));if(r){e.preventDefault();e.stopPropagation();this.stimulate(r.split("->")[1],t)}}});e.reflexes||Object.defineProperty(e,"reflexes",{get(){return new Proxy(T,{get:function(e,t){return t==="last"?this.lastReflex:Object.fromEntries(Object.entries(e[t]).filter((([e,t])=>t.controller===this)))}.bind(this)})}});Qe(e.element,e);E("stimulus-reflex:controller-registered",{detail:{controller:e}})};const Xe=(e,t={})=>{Ke(e,t)};document.addEventListener("cable-ready:after-dispatch-event",Me);document.addEventListener("cable-ready:before-inner-html",ze);document.addEventListener("cable-ready:before-morph",ze);document.addEventListener("cable-ready:after-inner-html",Fe);document.addEventListener("cable-ready:after-morph",Fe);document.addEventListener("readystatechange",(()=>{document.readyState==="complete"&&Je()}));var Ye=Object.freeze({__proto__:null,StimulusReflexController:StimulusReflexController,initialize:Ge,reflexes:T,register:Ke,scanForReflexes:Je,scanForReflexesOnElement:Qe,useReflex:Xe});const et={version:Ne.version,...Ye,get debug(){return c.value},set debug(e){c.set(!!e)},get deprecate(){return l.value},set deprecate(e){l.set(!!e)}};window.StimulusReflex=et;export{StimulusReflexController,et as default,Ge as initialize,T as reflexes,Ke as register,Je as scanForReflexes,Qe as scanForReflexesOnElement,Xe as useReflex};

